<!DOCTYPE html><html class="dark"><head><meta charset="utf-8"><title>Custom Type Errors for Unordered Function Application</title><meta name="og:title" content="Custom Type Errors for Unordered Function Application"><meta property="og:image" content="https://mgsloan.com/images/haskell-placeholder-banner.jpg"><meta property="og:site_name" content="mgsloan"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="treetopian"><link href="/favicon.png" rel="icon" type="image/png"><link href="/feed.xml" rel="alternate" type="application/atom+xml"><link href="https://mgsloan.com/posts/unordered-apply-type-errors/" rel="canonical"><meta name="description" content="Better type errors via GHC's custom type errors."><meta name="og:description" content="Better type errors via GHC's custom type errors."><meta name="author" content="Michael G Sloan"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="https://fonts.googleapis.com/css?family=Alegreya:700|Alegreya+Sans:400,400i,700|Alegreya+Sans+SC:400|Inconsolata:400,700|Playfair+Display:400,700" rel="stylesheet"><style>*{margin:0;padding:0}code,em,strong{line-height:1}html{font-size:16px;zoom:1.15;background-color:#234}body{background-color:#fffef8;padding-top:0.2em;color:#456;font-family:'Alegreya Sans',sans-serif;font-feature-settings:'liga','kern';line-height:1.6}#content,#teaser,#footer{padding:1.4em;margin-left:auto;margin-right:auto;max-width:36em}#content{padding-top:0;min-height:-moz-available;min-height:-webkit-fill-available;min-height:fill-available}header{font-family:'Playfair Display',sans;overflow:visible;text-align:center;margin-bottom:1.0em}h1{font-family:'Playfair Display',serif;color:#000;font-size:1.6em;line-height:3.8rem;margin-bottom:0.7rem;padding-top:2.8rem}header>h2{font-feature-settings:'dlig';font-size:1.4em;font-style:italic;font-weight:normal;line-height:1.4rem;margin-bottom:1.0rem;padding-top:0.4rem}header>p{padding-top:0.5em;padding-bottom:0.9em;margin-bottom:0}article>header>hr.hairline{margin-top:0.5em;transform:scale(1.3,0.5)}article hr.hairline{transform:scale(1.09,0.5)}hr.hairline{border:none;border-bottom:1px solid #c35;transform:scale(1,0.5)}.footnotes-divider{margin-top:3.4em;margin-bottom:2.4em}.comments-divider{margin-top:2.4em;margin-bottom:2.4em}h1>br{display:none}p,nav{margin-bottom:1em;padding-top:0.4em}a{color:#c35;text-decoration:none}a:hover,a:focus{text-decoration:underline;text-decoration-thickness:0.5px;text-underline-offset:3px}abbr,.smcp{font-family:"Alegreya Sans SC";letter-spacing:0.1em;display:inline-block}abbr{letter-spacing:0.03em;margin-right:-0.03em}.run-in{font-family:"Alegreya Sans SC";letter-spacing:0.05em}h2{font-family:Alegreya,serif;font-size:1.4em;line-height:1em;margin-bottom:0.2rem;padding-top:1.2rem}h2>a:before{content:'¶';width:1.2rem;margin-left:-1.2rem;display:inline-block;opacity:0;transition:opacity 0.2s ease-out;color:#b4aaaa}h2:hover>a:before{opacity:1}h2:target>a:before{opacity:1;color:#c35}ul,ol{counter-reset:ol;list-style:none;margin-top:1em}li{position:relative}li:before{display:inline-block;margin-left:-1em;width:1em;position:absolute;top:0}ul>li:before{content:'•';font-weight:bold;transform:scale(1.6);top:-0.15em}ul.affiliate>li:before{content:'$';transform:scale(1)}ol>li:before{content:counter(ol,decimal);counter-increment:ol;font-weight:bold;top:-0.05em}li>p:first-child{display:inline-block;padding-top:0}li>p:first-child + *{margin-top:0}li>ul,li>ol{margin-left:1em}li>ul>li:before{content:"■";transform:scale(0.5);top:-0.05em}table{border-spacing:0;margin-bottom:1em;margin-left:auto;margin-right:auto;text-align:left}th{padding-top:0.4em}th,td{padding-right:1.4em;vertical-align:top}code{font-family:Inconsolata,monospace;word-break:break-word;background-color:rgba(27,31,35,0.07);padding:0.2em}pre>code{background-color:transparent;padding:0}pre{border:1px solid #4568;color:#456;margin-bottom:0.6rem;margin-top:0.2rem;overflow-x:auto;padding:1rem;padding-left:1.4rem;margin-left:-1.4rem;margin-right:-1.4rem;font-size:0.9rem;line-height:1.4rem}pre:hover{overflow-x:auto}::-webkit-scrollbar{background-color:#fffef8}::-webkit-scrollbar-track{background-color:#fffef8}::-webkit-scrollbar-thumb{background-color:#c35}pre::-webkit-scrollbar-thumb{background-color:#fffef8}pre:hover::-webkit-scrollbar-thumb{background-color:#c35}.kw,.cf{color:#07a}.dt,.at{color:#d56}.op{color:#690}.dv,.bn,.fl,.er{color:#905}.ch,.st{color:#d80}.co{color:#789}blockquote{font-style:italic;padding-left:1em;padding-right:1em}sup,sub{vertical-align:baseline;position:relative}sup{top:-0.4em}sub{top:0.4em}#teaser-section{background-color:#c35;color:#f5b2c8}#teaser p:first-child{margin-bottom:0.3em}#teaser a{color:#fff;font-family:Alegreya,serif;line-height:0}#teaser a:after{color:#fff;content:'\a0»'}#teaser>h2{margin-bottom:0.2rem;padding-top:0.5rem}footer{background-color:#234;color:#b4aaaa}#notices{clear:both;text-align:center;padding-top:1.8em;display:block}#profile-links{clear:both;text-align:center;margin-left:2.5em;display:block}footer span{margin-left:0.25em;margin-right:0.25em}#comments{margin-left:-0.3em}@media(min-width:400px){#content,#teaser,#footer{padding-left:2em;padding-right:2em}h1{font-size:1.8em}}@media(min-width:470px){html{font-size:16px}}@media(min-width:544px){#content,#teaser,#footer{padding-left:2.8em;padding-right:2.8em}li{margin-left:0}}@media(min-width:625px){html{font-size:17px}h1>br{display:block}h2>a:before{width:1.6rem;margin-left:-1.6rem}#comments{margin-left:-3.2em}}@media(min-width:802px){html{font-size:18px}h1{font-size:2.0em}header{margin-top:1.4em}#comments{margin-left:-3em}}@media(min-width:1003px){html{font-size:19px}h1{font-size:2.6em}}@media(min-width:1225px){#footer{max-width:42em}footer h2{margin-left:3rem}footer nav{float:left;text-align:right;width:6em;margin-left:-5em}#about{float:right;width:36em;margin-right:3em}}@media(max-width:399px){article li:before{margin-left:-0.5em}}@media(max-width:490px){#breakdot{display:block;height:0;overflow:hidden;width:0}li:before{margin-left:-0.95em}#profile-links{margin-left:0}}@media (-webkit-min-device-pixel-ratio:2),(min-device-pixel-ratio:2),(min-resolution:192dpi){pre{border-width:0.5px}}.dark body,.dark ::-webkit-scrollbar,.dark ::-webkit-scrollbar-track,.dark pre::-webkit-scrollbar-thumb{background-color:#1a2633;color:#eee}.dark h1,.dark h2,.dark h3,.dark h2>a:before{color:#eee}.dark .archive h2{color:#577ea8}.dark code{background-color:#eee2}.dark pre{border:1px solid #97a8ba;color:#97a8ba}.dark pre>code{background-color:transparent}.dark a{color:#e05271}.dark hr.hairline{border-bottom:1px solid #e05271}.dark .kw,.dark .cf{color:#07a}.dark .dt,.dark .at{color:#d56}.dark .op{color:#690}.dark .dv,.dark .bn,.dark .fl,.dark .er{color:#e6007e}.dark .ch,.dark .st{color:#d80}.dark .co{color:#789}dark-mode-toggle{position:fixed;top:0;right:0;transform:scale(1.5)}dark-mode-toggle input{outline:none}</style><script async src="https://www.googletagmanager.com/gtag/js?id=UA-126869629-1"></script><script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-126869629-1');</script></head><body><article id="content" itemscope><header><h1>Custom Type Errors for Unordered Function Application</h1><p><a href="/" class="author">mgsloan</a><br><time datetime="2021-04-06" itemprop="datePublished">2021-04-06</time></p></header><hr class="hairline"><p><span class="run-in"></span>In the <a href="/posts/unordered-apply">previous post</a>, a
combination of a typeclass, closed type family, and associated type
family was used to define an operator, <code>(?)</code>. This operator
provides type-directed function application, where the argument is
provided to the first parameter that has a matching type.</p><p>This post will describe improving some of the type errors that can
occur when using this operator, by using <abbr>GHC</abbr>'s <a href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/exts/type_errors.html">custom
type errors</a> feature.</p><h2 id="argument-mismatch-error"><a href="#argument-mismatch-error"></a>Argument mismatch error</h2><p>With the definitions in the <a href="/posts/unordered-apply">previous
post</a>, usage of <code>(?)</code> with an argument that has no
matching parameter results in unclear type errors:</p><div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> cons <span class="op">?</span> <span class="dt">True</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>interactive<span class="op">&gt;:</span><span class="dv">1</span><span class="op">:</span><span class="dv">1</span><span class="op">:</span> <span class="fu">error</span><span class="op">:</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">No</span> <span class="kw">instance</span> for (<span class="dt">ApplyByType</span> <span class="dt">'NoArgToMatch</span> <span class="dt">Bool</span> <span class="dt">Text</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        arising from a use <span class="kw">of</span> ‘<span class="op">?</span>’</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">In</span> the expression<span class="op">:</span> cons <span class="op">?</span> <span class="dt">True</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">In</span> an equation for ‘it’<span class="op">:</span> it <span class="ot">=</span> cons <span class="op">?</span> <span class="dt">True</span></span></code></pre></div><p>In order for the programmer to understand this error, they would need
to know exactly how the type-level machinery around
<code>ApplyByType</code> is structured, and then simulate this machinery
in their head. It would be nice if <abbr>GHC</abbr> was more informative for cases
like this. <a href="/posts/inspecting-haskell-instance-resolution/">"Inspecting
Haskell Instance Resolution"</a> suggests some ways this could be
improved. Instead the error might be:</p><div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>interactive<span class="op">&gt;:</span><span class="dv">1</span><span class="op">:</span><span class="dv">1</span><span class="op">:</span> <span class="fu">error</span><span class="op">:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">No</span> <span class="kw">instance</span> for (<span class="dt">ApplyByType</span> matches3 <span class="dt">Bool</span> (<span class="dt">Char</span> <span class="ot">-&gt;</span> <span class="dt">Text</span> <span class="ot">-&gt;</span> <span class="dt">Text</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        arising from a use <span class="kw">of</span> ‘<span class="op">?</span>’</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">Due</span> to no <span class="kw">instance</span> for (<span class="dt">ApplyByType</span> matches3 <span class="dt">Int</span> <span class="dt">Text</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>      arising from superclass constraints<span class="op">:</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ApplyByType</span> matches1 <span class="dt">Bool</span> <span class="dt">Text</span> <span class="ot">=&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ApplyByType</span> matches2 <span class="dt">Bool</span> (<span class="dt">Text</span> <span class="ot">-&gt;</span> <span class="dt">Text</span>) <span class="ot">=&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ApplyByType</span> matches3 <span class="dt">Bool</span> (<span class="dt">Char</span> <span class="ot">-&gt;</span> <span class="dt">Text</span> <span class="ot">-&gt;</span> <span class="dt">Text</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>      with</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        matches1 <span class="op">~</span> <span class="dt">MatchFirstArg</span> <span class="dt">Bool</span> <span class="dt">Text</span> <span class="op">~</span> <span class="dt">'NoArgToMatch</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        matches2 <span class="op">~</span> <span class="dt">MatchFirstArg</span> <span class="dt">Bool</span> (<span class="dt">Text</span> <span class="ot">-&gt;</span> <span class="dt">Text</span>) <span class="op">~</span> <span class="dt">Doesn'tMatch</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        matches3 <span class="op">~</span> <span class="dt">MatchFirstArg</span> <span class="dt">Bool</span> (<span class="dt">Char</span> <span class="ot">-&gt;</span> <span class="dt">Text</span> <span class="ot">-&gt;</span> <span class="dt">Text</span>) <span class="op">~</span> <span class="dt">Doesn'tMatch</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">In</span> the expression<span class="op">:</span> cons <span class="op">?</span> <span class="dt">True</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">In</span> an equation for ‘it’<span class="op">:</span> it <span class="ot">=</span> cons <span class="op">?</span> <span class="dt">True</span></span></code></pre></div><p>This makes it clear that the typeclass machinery recursed through the
function type and determined that none of the arguments matched.</p><p>Even just reporting that the instance directly used by
<code>(?)</code> is
<code>(ApplyByType Doesn'tMatch Bool (Char -&gt; Text -&gt; Text)</code>
helps clarify the issue.</p><h2 id="better-errors-via-custom-type-errors"><a href="#better-errors-via-custom-type-errors"></a>Better errors via custom
type errors</h2><p>Such inspection of type-level machinery does not currently exist, so
the only viable approach to improving this error is through use of <abbr>GHC</abbr>'s
<a href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/exts/type_errors.html">custom
type errors</a>.</p><p>Here's a first try at doing this:</p><div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">TypeError</span> (<span class="dt">NoMatchForResultError</span> a r)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>      <span class="ot">=&gt;</span> <span class="dt">ApplyByType</span> <span class="dt">'NoArgToMatch</span> a r <span class="kw">where</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">type</span> <span class="dt">ApplyByTypeResult</span> <span class="dt">'NoArgToMatch</span> a r <span class="ot">=</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">TypeError</span> (<span class="dt">NoMatchForResultError</span> a r)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  applyByTypeImpl <span class="ot">=</span> <span class="fu">error</span> <span class="st">"impossible"</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">NoMatchForResultError</span> a r <span class="ot">=</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">'Text</span> <span class="st">"Parameter type "</span> '<span class="op">:$$:</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">'Text</span> <span class="st">"  "</span> '<span class="op">:&lt;&gt;:</span> <span class="dt">'ShowType</span> a '<span class="op">:$$:</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">'Text</span> <span class="st">"does not occur in the arguments of the function that returns "</span> '<span class="op">:$$:</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">'Text</span> <span class="st">"  "</span> '<span class="op">:&lt;&gt;:</span> <span class="dt">'ShowType</span> r '<span class="op">:$$:</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">'Text</span> <span class="st">"and so cannot be applied via type directed application.</span></span></code></pre></div><p>This instance for the <code>NoArgToMatch</code> case has a
<code>TypeError</code> in its superclass constraint. Now, rather than
reporting a missing instance for this case, the custom type error
message will be shown. This message is defined by
<code>NoMatchForResultError</code>.</p><p>Here's how the various constructors for the error message work:</p><ul><li><p><code>Text</code> will output the provided <code>Symbol</code>
(type level string).</p></li><li><p><code>ShowType</code> will render the type as a string in the
output message.</p></li><li><p><code>(:&lt;&gt;:)</code> horizontally concatenates
messages.</p></li><li><p><code>(:$$:)</code> vertically concatenates messages.</p></li></ul><p>So, with this definition, the above type error becomes:</p><div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> cons <span class="op">?</span> <span class="dt">True</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>interactive<span class="op">&gt;:</span><span class="dv">1</span><span class="op">:</span><span class="dv">1</span><span class="op">:</span> <span class="fu">error</span><span class="op">:</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">Parameter</span> <span class="kw">type</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">Bool</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      does <span class="fu">not</span> occur <span class="kw">in</span> the arguments <span class="kw">of</span> the function that returns</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">Text</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">and</span> so cannot be applied via <span class="kw">type</span> directed application<span class="op">.</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">When</span> checking the inferred <span class="kw">type</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="ot">        it ::</span> <span class="dt">Char</span> <span class="ot">-&gt;</span> <span class="dt">Text</span> <span class="ot">-&gt;</span> (<span class="dt">TypeError</span> <span class="op">...</span>)</span></code></pre></div><p>Better! This version of the code is <a href="https://github.com/mgsloan/apply-unordered/blob/master/didactic/V4.hs">didactic/V4.hs
on github</a>.</p><h2 id="reporting-the-full-function-type"><a href="#reporting-the-full-function-type"></a>Reporting the full function
type</h2><p>Above, the type error above only reports the last return value of the
function. It would be clearer to show the full function type, so that
the programmer can directly see that none of the parameters have a type
which matches the argument.</p><p>One way to approach this is to have a closed type family which yields
the error when it finds no matching argument:</p><div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="kw">family</span> <span class="dt">HasAMatch</span> a f<span class="ot"> f0 ::</span> <span class="dt">Constraint</span> <span class="kw">where</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">HasAMatch</span> a (a <span class="ot">-&gt;</span> r) f0 <span class="ot">=</span> ()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">HasAMatch</span> a (b <span class="ot">-&gt;</span> r) f0 <span class="ot">=</span> <span class="dt">HasAMatch</span> a r f0</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">HasAMatch</span> a _ f0 <span class="ot">=</span> <span class="dt">TypeError</span> (<span class="dt">NoMatchErrorMsg</span> a f0)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">NoMatchErrorMsg</span> a f <span class="ot">=</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">'Text</span> <span class="st">"Parameter type "</span> '<span class="op">:$$:</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">'Text</span> <span class="st">"  "</span> '<span class="op">:&lt;&gt;:</span> <span class="dt">'ShowType</span> a '<span class="op">:$$:</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">'Text</span> <span class="st">"does not occur in the arguments of the function type "</span> '<span class="op">:$$:</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">'Text</span> <span class="st">"  "</span> '<span class="op">:&lt;&gt;:</span> <span class="dt">'ShowType</span> f '<span class="op">:$$:</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">'Text</span> <span class="st">"and so cannot be applied via type directed application."</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>(<span class="op">?</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="ot">  ::</span> <span class="kw">forall</span> matches a f<span class="op">.</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>     ( <span class="dt">HasAMatch</span> a f f</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>     , matches <span class="op">~</span> <span class="dt">MatchFirstArg</span> a f</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>     , <span class="dt">ApplyByType</span> matches a f</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="ot">=&gt;</span> f <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> <span class="dt">ApplyByTypeResult</span> matches a f</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>(<span class="op">?</span>) <span class="ot">=</span> applyByTypeImpl (<span class="dt">Proxy</span><span class="ot"> ::</span> <span class="dt">Proxy</span> matches)</span></code></pre></div><p>Similarly to the <code>ApplyByType</code> typeclass, the first
argument is the argument to match, and the second argument is the
function type being recursed on. The added clarity in the error message
comes from passing down the third argument, which has the full function
type.</p><p>Now the type error is much nicer:</p><div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> cons <span class="op">?</span> (<span class="dv">1</span><span class="ot"> ::</span> <span class="dt">Int</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>interactive<span class="op">&gt;:</span><span class="dv">1</span><span class="op">:</span><span class="dv">1</span><span class="op">:</span> <span class="fu">error</span><span class="op">:</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">Parameter</span> <span class="kw">type</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">Bool</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>      does <span class="fu">not</span> occur <span class="kw">in</span> the arguments <span class="kw">of</span> the function <span class="kw">type</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">Char</span> <span class="ot">-&gt;</span> <span class="dt">Text</span> <span class="ot">-&gt;</span> <span class="dt">Text</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">and</span> so cannot be applied via <span class="kw">type</span> directed application<span class="op">.</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">In</span> the expression<span class="op">:</span> cons <span class="op">?</span> (<span class="dv">1</span><span class="ot"> ::</span> <span class="dt">Int</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">In</span> an equation for ‘it’<span class="op">:</span> it <span class="ot">=</span> cons <span class="op">?</span> (<span class="dv">1</span><span class="ot"> ::</span> <span class="dt">Int</span>)</span></code></pre></div><p>This version of the code is <a href="https://github.com/mgsloan/apply-unordered/blob/master/didactic/V5.hs">didactic/V5.hs
on github</a>. Note that with this approach, the
<code>instance ApplyByType 'NoArgToMatch a r</code> is no longer
necessary because we handle that case using the <code>HasAMatch</code>
<a href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/exts/type_families.html#closed-type-families">closed
type family</a>.</p><p>That's it for now, thanks for reading! <a href="/posts/reorder-args">The next post</a> in this series uses
<code>?</code> to implement a <code>reorderArgs</code> function which
will permute function arguments to match a desired type signature.</p><hr class="hairline comments-divider"><div id="comments"></div></article><section id="teaser-section"><div id="teaser"><p class="smcp">More words</p><h2><a href="/posts/reorder-args/">Type-Directed Permutation of Function Parameters</a></h2><p>Variadic functions + unordered application. <a href="/posts/reorder-args/" class="smcp">Read</a></p></div></section><footer><div id="footer"><p id="notices" class="smcp"><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Copyleft 2018-2024</a> <span id="breakdot">·</span> <a rel="author" href="https://mgsloan.com">Michael G Sloan</a> <span id="breakdot">·</span> <a href="https://github.com/mgsloan/mgsloan-site">Site Code</a> <span id="breakdot">·</span> <a href="/feed.xml">Feed</a></p><p id="profile-links" class="smcp"><a href="https://github.com/mgsloan">GitHub</a> <span id="breakdot">·</span> <a href="https://twitter.com/treetopian">Twitter</a></p></div></footer><dark-mode-toggle></dark-mode-toggle><script type="module" src="/dark-mode-toggle.mjs"></script><script src="/theme.js"></script></body></html>